#!/Users/airx/hks/media/.venv/bin/python
"""
Unified video downloader and processor.
Usage: ./dl "source_url" "profile_id" [--DEV|--PROD] [--dry-run]
"""

import sys
import os
import logging
import argparse

# Add current directory to path so we can import core
sys.path.append(os.path.dirname(os.path.abspath(__file__)))

from core.config import load_config, add_common_args
from core.pipeline import process_url_logic

# Configure logging
logging.basicConfig(
    level=logging.INFO, format="%(asctime)s - %(levelname)s - %(message)s"
)


def main():
    parser = argparse.ArgumentParser(description="Download and process video from URL.")
    parser.add_argument("source", help="Video URL (YouTube, Pornhub)")
    parser.add_argument("profile_id", help="Profile ID of the owner")
    add_common_args(parser)

    args = parser.parse_args()
    config = load_config(args)

    source = args.source
    profile_id = args.profile_id

    if not source.startswith(("http://", "https://")):
        logging.error("Source must be a URL. Use 'ul' for local files.")
        sys.exit(1)

    process_url_logic(
        source, profile_id, args.dry_run, config, lat=args.lat, lng=args.lng
    )


if __name__ == "__main__":
    main()
